<?php

namespace Tests\Integration;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

/**
 * Database Integration Tests
 * 
 * Tests database operations for {Model}
 * Framework: PHPUnit with Laravel/Eloquent
 * 
 * Generated by: /gbm.qa.scaffold-tests
 */
class {Model}DatabaseTest extends TestCase
{
    use RefreshDatabase;
    
    /** @test */
    public function it_creates_{model}_with_valid_data()
    {
        // Arrange
        $data = [
            'name' => 'Test {Model}',
            // TODO: Add required fields
        ];
        
        // Act
        ${model} = {Model}::create($data);
        
        // Assert
        $this->assertNotNull(${model}->id);
        $this->assertEquals($data['name'], ${model}->name);
        $this->assertDatabaseHas('{models}', $data);
    }
    
    /** @test */
    public function it_finds_{model}_by_id()
    {
        // Arrange
        ${model} = {Model}::factory()->create();
        
        // Act
        $found = {Model}::find(${model}->id);
        
        // Assert
        $this->assertNotNull($found);
        $this->assertEquals(${model}->id, $found->id);
    }
    
    /** @test */
    public function it_updates_{model}_fields()
    {
        // Arrange
        ${model} = {Model}::factory()->create(['name' => 'Original']);
        
        // Act
        ${model}->update(['name' => 'Updated']);
        
        // Assert
        $this->assertEquals('Updated', ${model}->fresh()->name);
        $this->assertDatabaseHas('{models}', ['id' => ${model}->id, 'name' => 'Updated']);
    }
    
    /** @test */
    public function it_deletes_{model}()
    {
        // Arrange
        ${model} = {Model}::factory()->create();
        
        // Act
        ${model}->delete();
        
        // Assert
        $this->assertDatabaseMissing('{models}', ['id' => ${model}->id]);
    }
    
    /** @test */
    public function it_validates_required_fields()
    {
        // Arrange & Act & Assert
        $this->expectException(\Illuminate\Database\QueryException::class);
        {Model}::create([]); // Missing required fields
    }
    
    /** @test */
    public function it_enforces_unique_constraints()
    {
        // Arrange
        {Model}::factory()->create(['email' => 'unique@example.com']);
        
        // Act & Assert
        $this->expectException(\Illuminate\Database\QueryException::class);
        {Model}::factory()->create(['email' => 'unique@example.com']);
    }
    
    /** @test */
    public function it_sets_timestamps_automatically()
    {
        // Act
        ${model} = {Model}::factory()->create();
        
        // Assert
        $this->assertNotNull(${model}->created_at);
        $this->assertNotNull(${model}->updated_at);
    }
    
    /** @test */
    public function it_loads_relationships()
    {
        // Arrange
        ${model} = {Model}::factory()->create();
        // TODO: Create related records
        
        // Act
        $loaded = {Model}::with('relation')->find(${model}->id);
        
        // Assert
        $this->assertTrue($loaded->relationLoaded('relation'));
    }
}
